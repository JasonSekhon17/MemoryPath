<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Memory Path</title>
		<link rel="stylesheet" type="text/css" href="style.css">
		<script>
			var numOfTileInCol;
			var usedValuesIncol = [];
			var k =0;
			var path=[];
			var pointer;
			var startPoint;
			var input = 5;
			var path = [];
			var tiles = [];
			var col = [];
			var direction;
			var randomNumber;
			var isMatched = false;
			var correct = 0;
			//generate a right size of grid based on user input
			function generatedPath(){
				var table = document.getElementById("grid");
				var tbody = document.createElement("tbody");
				var row,column;
				var i;
				var counter = 1;
				for(i=1;i<=input;i++){
					row = document.createElement("tr");
					for(var j=1;j<=input;j++){
						column = document.createElement("td");
						column.setAttribute("id",counter);
						counter++;
						column.style.backgroundColor = "#0070c0";
						column.setAttribute('onmouseover', 'mouseOver(this)');    //for testing purposes
						column.setAttribute('onmouseout', 'mouseOut(this)');
						column.setAttribute('onclick', 'mouseClick(this)');
						row.appendChild(column);
						tiles.push(column);
					}
					tbody.appendChild(row);
				}
				table.appendChild(tbody);
			}
			//provide randomized path
			function randomizedPath(){
				counter =1;
				 //put tiles in the same column to a array 
				 // to use functions.
				 while(counter <=input){
						for(var j=0;j<tiles.length;j++){
							if(parseInt(tiles[j].id)%input==counter){
								col.push(tiles[j]);
							}
							if(counter==input&&parseInt(tiles[j].id)%input==0){
								col.push(tiles[j]);	
							}
						}

					if(counter==1){
						determineFirstCol(col);
					}else{
						determineOtherCol(col);
					}
					counter++;
					col = [];
				 }
			}
			//
			function determineFirstCol(array){
				numOfTileInCol = parseInt(Math.random()*3+1);
				col = array.slice(0);
				if(numOfTileInCol==1){
					startPoint = parseInt(Math.random()*input);
					pointer = startPoint;
					path.push(col[startPoint]);
				}else if(numOfTileInCol==2){
					startPoint = parseInt(Math.random()*(input-1));
					direction = parseInt(Math.random()*2);
					if(direction ==0){
						pointer = startPoint;
						path.push(col[startPoint+1]);
						path.push(col[startPoint]);
					}else{
						pointer = startPoint + 1;
						path.push(col[startPoint]);
						path.push(col[startPoint+1]);
					}

				}else{
					startPoint = parseInt(Math.random()*(input-2));
					direction = parseInt(Math.random()*2);
					if(direction ==0){
						pointer = startPoint;
						path.push(col[startPoint+2]);
						path.push(col[startPoint+1]);
						path.push(col[startPoint]);
					}else{
						pointer = startPoint+2;
						path.push(col[startPoint]);
						path.push(col[startPoint+1]);
						path.push(col[startPoint+2]);
					}
				}
				col = [];
			}
			function determineOtherCol(array){
				numOfTileInCol = parseInt(Math.random()*3+1);
				col = array.slice(0);
				if(numOfTileInCol==1){
					col[pointer].style.background="green";
					path.push(col[pointer]);
				}else if(numOfTileInCol==2){
					while(!isMatched){
						randomNumber = parseInt(Math.random()*4);
						if(randomNumber==pointer  && randomNumber+1 <=(input-1)|| randomNumber+1==pointer && randomNumber+1 <=(input-1)){
							isMatched = true;
						}
					}
					isMatched = false;
					for(i=0;i<numOfTileInCol;i++){
						usedValuesIncol[i] = randomNumber + i;
					}
					if(randomNumber==pointer){

						pointer = usedValuesIncol[1];
						path.push(col[usedValuesIncol[0]]);
						path.push(col[usedValuesIncol[1]]);
					}else{
						pointer = usedValuesIncol[0];
						path.push(col[usedValuesIncol[1]]);
						path.push(col[usedValuesIncol[0]]);
					}
				}else{
					while(!isMatched){
						randomNumber = parseInt(Math.random()*3);
						if(randomNumber==pointer && randomNumber+2 <=(input-1) || randomNumber+2==pointer && randomNumber+2 <=(input-1)){
							isMatched = true;
						}
					}
					isMatched = false;
					for(i=0;i<numOfTileInCol;i++){
						usedValuesIncol[i] = randomNumber + i;
					}
					if(randomNumber ==pointer){

						pointer = usedValuesIncol[usedValuesIncol.length-1];
						path.push(col[usedValuesIncol[0]]);
						path.push(col[usedValuesIncol[1]]);
						path.push(col[usedValuesIncol[2]]);
					}else{
						
						pointer = usedValuesIncol[0];
						path.push(col[usedValuesIncol[2]]);
						path.push(col[usedValuesIncol[1]]);
						path.push(col[usedValuesIncol[0]]);
					}
				}
				usedValuesIncol = [];
				col = [];
			}
		function drawPath(){
			for(i=0;i<path.length;i++){
				path[i].className = "step"+i;
				path[i].style.background="green";
			}
		}
		function mouseClick(e) {
			if (e.classList.contains('step' + window.correct)){
				e.style.backgroundColor = "green";
				window.correct++;
			} else {
				if (!e.classList.contains('clicked')){
				e.style.backgroundColor = "red";
				//e.innerHTML = e.className;
				}
			}
			
			e.className += " clicked";
		}
			
		function mouseOver(e) {
			if (!e.classList.contains('clicked')){
				e.style.backgroundColor = "blue";
			}
		}
		
		function mouseOut(e) {
			if (!e.classList.contains('clicked')){
				e.style.backgroundColor = "#0070c0";
				//e.innerHTML = window.correct;
			}
		}
		
		window.addEventListener("load", generatedPath, false);
		window.addEventListener("load", randomizedPath, false);	
		window.addEventListener("load", drawPath, false);
		</script>
	</head>
	<body>
		
		<table id="grid"></table>
	</body>
</html>